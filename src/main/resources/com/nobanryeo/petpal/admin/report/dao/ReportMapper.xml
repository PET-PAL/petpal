<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nobanryeo.petpal.admin.report.dao.ReportMapper">

<resultMap id="ReportSet" type="ReportDTO">
		<id column="BOARD_CODE" property="boardCode" />
		<result column="USER_ID" property="userId" />
		<result column="REPORT_TITLE" property="boardTitle" />
		<result column="REPORTED_USER" property="reportedUser" />
		<result column="REPORT_DATE" property="reportDate" />
		<result column="STATE" property="state" />
	</resultMap>
	<select id="selectReportCount" resultType="int">
	   SELECT COUNT(*) 
	   	<choose>
	   	<when test="category == 7">
	   	FROM REPLY_REPORT_TABLE A
	   	<if test='searchCondition == "userId"'>
        JOIN USER_TABLE B ON(A.USER_CODE = B.USER_CODE)
		WHERE B.USER_ID = #{searchValue}
		
		</if>
		<if test='searchCondition == "boardTitle"'>
		WHERE A.REPLY_REPORT_TITLE = #{searchValue}
		</if>
	   	
	   	
	   	</when>
	   	<otherwise>
	   	<if test='category == "0"'>
		FROM FREE_BOARD_REPORT A
		</if>
		<if test='category == "1"'>
		FROM INFO_BOARD_REPORT A
		</if>
		<if test='category == "2"'>
		FROM SHARE_BOARD_REPORT A
		</if>
		<if test='category == "3"'>
		FROM REVIEW_BOARD_REPORT A
		</if>
		<if test='category == "4"'>
		FROM MISSING_BOARD_REPORT A
		</if>
		<if test='category == "5"'>
		FROM FRIENDLY_BOARD_REPORT A
		</if>
		<if test='category == "6"'>
		FROM ADOPT_BOARD_REPORT A
		</if>
		<if test='searchCondition == "userId"'>
	   	JOIN REPORT_MANAGE B ON(A.REPORT_CODE = B.REPORT_CODE)
        JOIN USER_TABLE C ON(B.USER_CODE = C.USER_CODE)
		WHERE C.USER_ID = #{searchValue}
		
		</if>
		<if test='searchCondition == "boardTitle"'>
		JOIN REPORT_MANAGE B ON(A.REPORT_CODE = B.REPORT_CODE)
		WHERE B.REPORT_TITLE = #{searchValue}
		</if>
	   	</otherwise>
	   	</choose>
		
	</select>
	<select id="selectReport" resultMap="ReportSet" parameterType="ReportDTO">
	SELECT
        *
        FROM( SELECT ROWNUM RNUM, G.*
                    FROM (SELECT
                    		<choose>
                    		<when test="category == 7">
                    		A.REPLY_CODE AS BOARD_CODE,
						    C.USER_ID,
						    B.USER_ID AS REPORTED_USER,
						    A.REPLY_REPORT_TITLE AS REPORT_TITLE,
						    A.REPLY_REPORT_DATE AS REPORT_DATE,
						    NVL2(A.DECISION_CODE,E.STATE_NAME,'대기중') AS STATE
						    
						    
						    FROM REPLY_REPORT_TABLE A
						    JOIN USER_TABLE B ON(A.USER_CODE1 = B.USER_CODE)
						    JOIN USER_TABLE C ON(A.USER_CODE = C.USER_CODE)
						    LEFT OUTER JOIN DECISION_TABLE D ON(A.DECISION_CODE = D.DECISION_CODE)
						    LEFT OUTER JOIN STATE_TABLE E ON(D.STATE_CODE = E.STATE_CODE)
						    
                    		<if test='searchCondition == "userId"'>
							WHERE C.USER_ID = #{searchValue}
							
							</if>
							<if test='searchCondition == "boardTitle"'>
							WHERE A.REPLY_REPORT_TITLE = #{searchValue}
							</if>
							
							<choose>
								<when test="sortValue == 1">
									ORDER BY E.STATE_NAME DESC ,A.REPLY_CODE DESC
											
								</when>
								<when test="sortValue == 2">
									ORDER BY E.STATE_NAME ASC ,A.REPLY_CODE DESC
								</when>
								<otherwise>
									ORDER BY A.REPLY_CODE DESC
								</otherwise>
							</choose>
                    		
                    		</when>
                    		
                    		
                    		
                    		<otherwise>
                    		C.BOARD_CODE,
                            D.USER_ID,
                            B.REPORT_TITLE,
                            G.USER_ID AS REPORTED_USER,
                            B.REPORT_DATE,
                            NVL2(B.DECISION_CODE,F.STATE_NAME,'대기중') AS STATE
                            <if test='category == "0"'>
							FROM FREE_BOARD_REPORT A
							JOIN FREE_BOARD C ON(A.BOARD_CODE = C.BOARD_CODE)
							</if>
							<if test='category == "1"'>
							FROM INFO_BOARD_REPORT A
							JOIN INFO_BOARD C ON(A.BOARD_CODE = C.BOARD_CODE)
							</if>
							<if test='category == "2"'>
							FROM SHARE_BOARD_REPORT A
							JOIN SHARE_BOARD C ON(A.BOARD_CODE = C.BOARD_CODE)
							</if>
							<if test='category == "3"'>
							FROM REVIEW_BOARD_REPORT A
							JOIN REVIEW_BOARD C ON(A.BOARD_CODE = C.BOARD_CODE)
							</if>
							<if test='category == "4"'>
							FROM MISSING_BOARD_REPORT A
							JOIN MISSING_BOARD C ON(A.BOARD_CODE = C.BOARD_CODE)
							</if>
							<if test='category == "5"'>
							FROM FRIENDLY_BOARD_REPORT A
							JOIN FRIENDLY_BOARD C ON(A.BOARD_CODE = C.BOARD_CODE)
							</if>
							<if test='category == "6"'>
							FROM ADOPT_BOARD_REPORT A
							JOIN ADOPT_BOARD C ON(A.BOARD_CODE = C.BOARD_CODE)
							</if>
	                        JOIN REPORT_MANAGE B ON(A.REPORT_CODE = B.REPORT_CODE)
	                        JOIN USER_TABLE D ON(B.USER_CODE = D.USER_CODE)
	                        LEFT OUTER JOIN DECISION_TABLE E ON(B.DECISION_CODE = E.DECISION_CODE)
	                        LEFT OUTER JOIN STATE_TABLE F ON(E.STATE_CODE = F.STATE_CODE)
	                        JOIN USER_TABLE G ON(C.USER_CODE = G.USER_CODE)
	                        
	                        <if test='searchCondition == "userId"'>
							WHERE D.USER_ID = #{searchValue}
							
							</if>
							<if test='searchCondition == "boardTitle"'>
							WHERE B.REPORT_TITLE = #{searchValue}
							</if>
							
							<choose>
								<when test="sortValue == 1">
									ORDER BY F.STATE_NAME DESC ,C.BOARD_CODE DESC
											
								</when>
								<when test="sortValue == 2">
									ORDER BY F.STATE_NAME ASC ,C.BOARD_CODE DESC
								</when>
								<otherwise>
									ORDER BY C.BOARD_CODE DESC
								</otherwise>
							</choose>
                    		</otherwise>
                    		</choose>
                            
                        )G
                )A 
                WHERE RNUM BETWEEN #{start} AND #{end}
	
	
	
	</select>
	
	
</mapper>